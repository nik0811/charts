{
  "phases": {
    "package": {
      "context": {
        "resources": {
          "url": "{SHA_ARCHIVE}",
          "path": "/bitnami/pinniped"
        }
      },
      "actions": [
        {
          "action_id": "helm-package"
        },
        {
          "action_id": "helm-lint"
        }
      ]
    },
    "verify": {
      "context": {
        "resources": {
          "url": "{SHA_ARCHIVE}",
          "path": "/bitnami/pinniped"
        },
        "runtime_parameters": "c3VwZXJ2aXNvcjoKICBlbmFibGVkOiB0cnVlCiAgcmJhYzoKICAgIGNyZWF0ZTogdHJ1ZQogIGV4dHJhVm9sdW1lczoKICAtIG5hbWU6IHRscwogICAgc2VjcmV0OgogICAgICBzZWNyZXROYW1lOiBwaW5uaXBlZC1zdXBlcnZpc29yLWRlZmF1bHQtdGxzLWNlcnRpZmljYXRlCiAgc2VydmljZToKICAgIHR5cGU6IExvYWRCYWxhbmNlcgogICAgcG9ydHM6CiAgICAgIGh0dHBzOiA0NDMKICBob3N0QWxpYXNlczoKICAgIC0gaXA6IDEyNy4wLjAuMQogICAgICBob3N0bmFtZXM6CiAgICAgICAgLSBwaW5uaXBlZC1zdXBlcnZpc29yCiAgaG9zdG5hbWU6IHBpbm5pcGVkLXN1cGVydmlzb3IKY29uY2llcmdlOgogIGVuYWJsZWQ6IHRydWUKICByYmFjOgogICAgY3JlYXRlOiB0cnVlCmV4dHJhRGVwbG95OgotIHwKICB7ey0gJGNhIDo9IGdlbkNBICJwaW5uaXBlZC1jYSIgMzY1IH19CiAge3stICRwaW5uaXBlZF9ob3N0bmFtZSA6PSAicGlubmlwZWQtc3VwZXJ2aXNvciIgfX0KICB7ey0gJHBpbm5pcGVkX2NlcnQgOj0gZ2VuU2lnbmVkQ2VydCAkcGlubmlwZWRfaG9zdG5hbWUgbmlsIChsaXN0ICRwaW5uaXBlZF9ob3N0bmFtZSkgMzY1ICRjYSB9fQogIGFwaVZlcnNpb246IHYxCiAga2luZDogU2VjcmV0CiAgbWV0YWRhdGE6CiAgICBuYW1lOiBwaW5uaXBlZC1zdXBlcnZpc29yLWRlZmF1bHQtdGxzLWNlcnRpZmljYXRlCiAgICBuYW1lc3BhY2U6IHt7IGluY2x1ZGUgImNvbW1vbi5uYW1lcy5uYW1lc3BhY2UiICQgfCBxdW90ZSB9fQogIHR5cGU6IGt1YmVybmV0ZXMuaW8vdGxzCiAgZGF0YToKICAgIHRscy5jcnQ6IHt7ICRwaW5uaXBlZF9jZXJ0LkNlcnQgfCBiNjRlbmMgfCBxdW90ZSB9fQogICAgdGxzLmtleToge3sgJHBpbm5pcGVkX2NlcnQuS2V5IHwgYjY0ZW5jIHwgcXVvdGUgfX0KICAgIGNhLmNydDoge3sgJGNhLkNlcnQgfCBiNjRlbmMgfCBxdW90ZSB9fQogIC0tLQogIHt7LSAkb3BlbmxkYXBfaG9zdG5hbWUgOj0gKHByaW50ZiAib3BlbmxkYXAuJXMuc3ZjLmNsdXN0ZXIubG9jYWwiIC5SZWxlYXNlLk5hbWVzcGFjZSkgfX0KICB7ey0gJG9wZW5sZGFwX2NlcnQgOj0gZ2VuU2lnbmVkQ2VydCAkb3BlbmxkYXBfaG9zdG5hbWUgbmlsIChsaXN0ICRvcGVubGRhcF9ob3N0bmFtZSkgMzY1ICRjYSB9fQogIGFwaVZlcnNpb246IHYxCiAga2luZDogU2VjcmV0CiAgbWV0YWRhdGE6CiAgICBuYW1lOiBvcGVubGRhcC1jZXJ0cwogICAgbmFtZXNwYWNlOiB7eyBpbmNsdWRlICJjb21tb24ubmFtZXMubmFtZXNwYWNlIiAkIHwgcXVvdGUgfX0KICB0eXBlOiBrdWJlcm5ldGVzLmlvL3RscwogIGRhdGE6CiAgICB0bHMuY3J0OiB7eyAkb3BlbmxkYXBfY2VydC5DZXJ0IHwgYjY0ZW5jIHwgcXVvdGUgfX0KICAgIHRscy5rZXk6IHt7ICRvcGVubGRhcF9jZXJ0LktleSB8IGI2NGVuYyB8IHF1b3RlIH19CiAgICBjYS5jcnQ6IHt7ICRjYS5DZXJ0IHwgYjY0ZW5jIHwgcXVvdGUgfX0KICAtLS0KICAjIFJlc291cmNlIHRlbXBsYXRlcyBvYnRhaW5lZCBmcm9tIHBpbm5pcGVkIGRvYwogICMgUmVmOiBodHRwczovL3Bpbm5pcGVkLmRldi9kb2NzL2hvd3RvL2NvbmZpZ3VyZS1zdXBlcnZpc29yLXdpdGgtb3BlbmxkYXAvCiAgYXBpVmVyc2lvbjogY29uZmlnLnN1cGVydmlzb3IucGlubmlwZWQuZGV2L3YxYWxwaGExCiAga2luZDogRmVkZXJhdGlvbkRvbWFpbgogIG1ldGFkYXRhOgogICAgbmFtZTogbXktcHJvdmlkZXIKICAgIG5hbWVzcGFjZToge3sgaW5jbHVkZSAiY29tbW9uLm5hbWVzLm5hbWVzcGFjZSIgJCB8IHF1b3RlIH19CiAgc3BlYzoKICAgIGlzc3VlcjogaHR0cHM6Ly9waW5uaXBlZC1zdXBlcnZpc29yL2RlbW8taXNzdWVyCiAgLS0tCiAgIyMgUmVmOiBodHRwczovL3Bpbm5pcGVkLmRldi9kb2NzL2hvd3RvL2NvbmZpZ3VyZS1zdXBlcnZpc29yLXdpdGgtb3BlbmxkYXAvCiAgIyMKICBhcGlWZXJzaW9uOiBhcHBzL3YxCiAga2luZDogRGVwbG95bWVudAogIG1ldGFkYXRhOgogICAgbmFtZTogb3BlbmxkYXAKICAgIGxhYmVsczoKICAgICAgYXBwOiBvcGVubGRhcAogIHNwZWM6CiAgICByZXBsaWNhczogMQogICAgc2VsZWN0b3I6CiAgICAgIG1hdGNoTGFiZWxzOgogICAgICAgIGFwcDogb3BlbmxkYXAKICAgIHRlbXBsYXRlOgogICAgICBtZXRhZGF0YToKICAgICAgICBsYWJlbHM6CiAgICAgICAgICBhcHA6IG9wZW5sZGFwCiAgICAgIHNwZWM6CiAgICAgICAgY29udGFpbmVyczoKICAgICAgICAgIC0gbmFtZTogb3BlbmxkYXAKICAgICAgICAgICAgaW1hZ2U6IGRvY2tlci5pby9iaXRuYW1pL29wZW5sZGFwCiAgICAgICAgICAgIGltYWdlUHVsbFBvbGljeTogQWx3YXlzCiAgICAgICAgICAgIHBvcnRzOgogICAgICAgICAgICAgIC0gbmFtZTogb3BlbmxkYXAKICAgICAgICAgICAgICAgIGNvbnRhaW5lclBvcnQ6IDEzODkKICAgICAgICAgICAgICAtIG5hbWU6IG9wZW5sZGFwcwogICAgICAgICAgICAgICAgY29udGFpbmVyUG9ydDogMTYzNgogICAgICAgICAgICByZWFkaW5lc3NQcm9iZToKICAgICAgICAgICAgICB0Y3BTb2NrZXQ6CiAgICAgICAgICAgICAgICBwb3J0OiBvcGVubGRhcAogICAgICAgICAgICAgIGluaXRpYWxEZWxheVNlY29uZHM6IDIKICAgICAgICAgICAgICB0aW1lb3V0U2Vjb25kczogOTAKICAgICAgICAgICAgICBwZXJpb2RTZWNvbmRzOiAyCiAgICAgICAgICAgICAgZmFpbHVyZVRocmVzaG9sZDogOQogICAgICAgICAgICBlbnY6CiAgICAgICAgICAgICAgLSBuYW1lOiBMREFQX0FETUlOX1VTRVJOQU1FCiAgICAgICAgICAgICAgICB2YWx1ZTogImFkbWluIgogICAgICAgICAgICAgIC0gbmFtZTogTERBUF9BRE1JTl9QQVNTV09SRAogICAgICAgICAgICAgICAgdmFsdWU6ICJhZG1pbjEyMyIKICAgICAgICAgICAgICAtIG5hbWU6IExEQVBfUk9PVAogICAgICAgICAgICAgICAgdmFsdWU6ICJkYz1waW5uaXBlZC1zdXBlcnZpc29yIgogICAgICAgICAgICAgIC0gbmFtZTogTERBUF9VU0VSX0RDCiAgICAgICAgICAgICAgICB2YWx1ZTogInVzZXJzIgogICAgICAgICAgICAgIC0gbmFtZTogTERBUF9VU0VSUwogICAgICAgICAgICAgICAgdmFsdWU6ICJ2aWJ1c2VyIgogICAgICAgICAgICAgIC0gbmFtZTogTERBUF9QQVNTV09SRFMKICAgICAgICAgICAgICAgIHZhbHVlOiAidmliVXNlcjEyMyIKICAgICAgICAgICAgICAtIG5hbWU6IExEQVBfR1JPVVAKICAgICAgICAgICAgICAgIHZhbHVlOiAidXNlcnMiCiAgICAgICAgICAgICAgLSBuYW1lOiBMREFQX0VOQUJMRV9UTFMKICAgICAgICAgICAgICAgIHZhbHVlOiAieWVzIgogICAgICAgICAgICAgIC0gbmFtZTogTERBUF9UTFNfQ0VSVF9GSUxFCiAgICAgICAgICAgICAgICB2YWx1ZTogIi92YXIvY2VydHMvdGxzLmNydCIKICAgICAgICAgICAgICAtIG5hbWU6IExEQVBfVExTX0tFWV9GSUxFCiAgICAgICAgICAgICAgICB2YWx1ZTogIi92YXIvY2VydHMvdGxzLmtleSIKICAgICAgICAgICAgICAtIG5hbWU6IExEQVBfVExTX0NBX0ZJTEUKICAgICAgICAgICAgICAgIHZhbHVlOiAiL3Zhci9jZXJ0cy9jYS5jcnQiCiAgICAgICAgICAgIHZvbHVtZU1vdW50czoKICAgICAgICAgICAgICAtIG5hbWU6IGNlcnRzCiAgICAgICAgICAgICAgICBtb3VudFBhdGg6IC92YXIvY2VydHMKICAgICAgICAgICAgICAgIHJlYWRPbmx5OiB0cnVlCiAgICAgICAgdm9sdW1lczoKICAgICAgICAgIC0gbmFtZTogY2VydHMKICAgICAgICAgICAgc2VjcmV0OgogICAgICAgICAgICAgIHNlY3JldE5hbWU6IG9wZW5sZGFwLWNlcnRzCiAgLS0tCiAgYXBpVmVyc2lvbjogdjEKICBraW5kOiBTZXJ2aWNlCiAgbWV0YWRhdGE6CiAgICBuYW1lOiBvcGVubGRhcAogICAgbGFiZWxzOgogICAgICBhcHA6IG9wZW5sZGFwCiAgc3BlYzoKICAgIHR5cGU6IENsdXN0ZXJJUAogICAgc2VsZWN0b3I6CiAgICAgIGFwcDogb3BlbmxkYXAKICAgIHBvcnRzOgogICAgICAtIHByb3RvY29sOiBUQ1AKICAgICAgICBwb3J0OiA2MzYKICAgICAgICB0YXJnZXRQb3J0OiAxNjM2CiAgICAgICAgbmFtZTogb3BlbmxkYXBzCiAgLS0tCiAgYXBpVmVyc2lvbjogaWRwLnN1cGVydmlzb3IucGlubmlwZWQuZGV2L3YxYWxwaGExCiAga2luZDogTERBUElkZW50aXR5UHJvdmlkZXIKICBtZXRhZGF0YToKICAgIG5hbWU6IG9wZW5sZGFwCiAgc3BlYzoKICAgIGhvc3Q6ICJvcGVubGRhcC57eyAuUmVsZWFzZS5OYW1lc3BhY2UgfX0uc3ZjLmNsdXN0ZXIubG9jYWwiCiAgICB0bHM6CiAgICAgIGNlcnRpZmljYXRlQXV0aG9yaXR5RGF0YToge3sgJGNhLkNlcnQgfCBiNjRlbmMgfCBxdW90ZSB9fQogICAgdXNlclNlYXJjaDoKICAgICAgYmFzZTogIm91PXVzZXJzLGRjPXBpbm5pcGVkLXN1cGVydmlzb3IiCiAgICAgIGZpbHRlcjogIiYob2JqZWN0Q2xhc3M9aW5ldE9yZ1BlcnNvbikodWlkPXt9KSIKICAgICAgYXR0cmlidXRlczoKICAgICAgICB1c2VybmFtZTogInVpZCIKICAgICAgICB1aWQ6ICJ1aWROdW1iZXIiCiAgICBncm91cFNlYXJjaDoKICAgICAgYmFzZTogIm91PXVzZXJzLGRjPXBpbm5pcGVkLXN1cGVydmlzb3IiCiAgICAgIGZpbHRlcjogIiYob2JqZWN0Q2xhc3M9Z3JvdXBPZk5hbWVzKShtZW1iZXI9e30pIgogICAgICBhdHRyaWJ1dGVzOgogICAgICAgIGdyb3VwTmFtZTogImNuIgogICAgYmluZDoKICAgICAgc2VjcmV0TmFtZTogb3BlbmxkYXAtYmluZC1hY2NvdW50CiAgLS0tCiAgYXBpVmVyc2lvbjogdjEKICBraW5kOiBTZWNyZXQKICBtZXRhZGF0YToKICAgIG5hbWU6IG9wZW5sZGFwLWJpbmQtYWNjb3VudAogIHR5cGU6IGt1YmVybmV0ZXMuaW8vYmFzaWMtYXV0aAogIHN0cmluZ0RhdGE6CiAgICB1c2VybmFtZTogImNuPWFkbWluLGRjPXBpbm5pcGVkLXN1cGVydmlzb3IiCiAgICBwYXNzd29yZDogImFkbWluMTIzIgogIC0tLQogICMjIFJlZjogaHR0cHM6Ly9waW5uaXBlZC5kZXYvZG9jcy9ob3d0by9jb25maWd1cmUtY29uY2llcmdlLWp3dC8KICAjIwogIGFwaVZlcnNpb246IGF1dGhlbnRpY2F0aW9uLmNvbmNpZXJnZS5waW5uaXBlZC5kZXYvdjFhbHBoYTEKICBraW5kOiBKV1RBdXRoZW50aWNhdG9yCiAgbWV0YWRhdGE6CiAgICBuYW1lOiBzdXBlcnZpc29yLWp3dC1hdXRoZW50aWNhdG9yCiAgICBuYW1lc3BhY2U6IHt7IGluY2x1ZGUgImNvbW1vbi5uYW1lcy5uYW1lc3BhY2UiICQgfCBxdW90ZSB9fQogIHNwZWM6CiAgICBpc3N1ZXI6ICJodHRwczovL3Bpbm5pcGVkLXN1cGVydmlzb3IvZGVtby1pc3N1ZXIiCiAgICBhdWRpZW5jZTogdmliLWVkOWRlMzNjMzcwOTgxZjYxZTljCiAgICB0bHM6CiAgICAgIGNlcnRpZmljYXRlQXV0aG9yaXR5RGF0YToge3sgJGNhLkNlcnQgfCBiNjRlbmMgfCBxdW90ZSB9fQo=",
        "target_platform": {
          "target_platform_id": "{VIB_ENV_ALTERNATIVE_TARGET_PLATFORM}",
          "size": {
            "name": "S4"
          }
        }
      },
      "actions": [
        {
          "action_id": "health-check",
          "params": {
            "endpoint": "lb-pinniped-supervisor-https"
          }
        },
        {
          "action_id": "ginkgo",
          "params": {
            "resources": {
              "path": "/.vib/pinniped/ginkgo"
            },
            "params": {
              "kubeconfig": "{{kubeconfig}}",
              "namespace": "{{namespace}}",
              "auth-user": "vibuser",
              "auth-password": "vibUser123"
            }
          }
        }
      ]
    },
    "publish": {
      "actions": [
        {
          "action_id": "helm-publish",
          "params": {
            "repository": {
              "kind": "S3",
              "url": "{VIB_ENV_S3_URL}",
              "username": "{VIB_ENV_S3_USERNAME}",
              "password": "{VIB_ENV_S3_PASSWORD}"
            }
          }
        }
      ]
    }
  }
}
